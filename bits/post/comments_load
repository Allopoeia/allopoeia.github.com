{% if page.enable-comments and site.meta.disqus_shortname %}
<script type="text/javascript">
	(function() {
		var e_comments = document.getElementById("comments");
		var e_loader = document.createElement("div");
		e_loader.id = "comment_loader";
		e_loader.className = "generic-center-text";

		var e_anchor = document.createElement("a");
		e_anchor.href = "javascript:load_comments()";
		e_anchor.innerText = "load comments (Disqus)";

		e_loader.appendChild(e_anchor);
		e_comments.appendChild(e_loader);
	})();

	var disqus_config = function () {
		this.page.url = "{{ site.meta.perma-url }}{{ page.url }}";
	{% if page.disqus_legacy_identifier %}
		this.page.identifier = "{{ site.meta.perma-url }}{{ page.url }}";
	{% else %}
		this.page.identifier = "{{ page.url }}";
	{% endif %}
		this.page.title = "{{ page.title }}";
	};

	var load_comments = function() {
		var e_loader = document.getElementById("comment_loader");
		e_loader.parentNode.removeChild(e_loader);

		var s = document.createElement('script');
		s.src = '//{{ site.meta.disqus_shortname }}.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(document.head || document.body).appendChild(s);
	};
</script>
{% endif %}
